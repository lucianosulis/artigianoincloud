{% extends 'base.html' %}
{% block header %}
  <h4>{% block title %}Dettaglio squadra{% endblock %}</h4>
{% endblock %}
{% block content %}
  <form>
    <input id="team_id" value="{{team['id'] }}" hidden>
    <label for="title">Nome squadra</label>
    <input name="title" id="title" value="{{team['title'] }}" readonly>
    <label for="date">Data</label>
    <input name="date" id="date" type="date" value="{{team['date'] }}" readonly>
    <label for="start_time">Orario d inizio</label>
    <input name="start_time" id="start_time" type="time" value="{{team['start_time'] }}" readonly>
    <label for="finish_time">Orario presunto di fine</label>
    <input name="finish_time" id="finish_time" type="time" value="{{ team['finish_time'] }}" readonly>
    <label for="notes">Note</label>
    <textarea name="notes" id="notes" readonly>{{ request.form['notes'] or team['notes'] }}</textarea>
  
    <br>
    <h4>Operatori previsti</h4>
    <div id="jsGridPeople"></div>
    <br>
    <h4>Mezzi previsti</h4>
    <div id="jsGridTool"></div>
    <br>
    <!-- Grid per la selezione delle attività -->
    <h4>Attività previste</h4>
    <div id="jsGridAct"></div>

      <table>
      <tr>
        <td>
          <input class="action" style="height:30px; width:160px" type="button" onclick="goBack()" value="Indietro">
          {% if show_calendar == "Y" %}
            <input name="goback" id="goback" value="{{ url_for('cal_team_planned.show_cal') }}" hidden>
          {% else %}
            <input name="goback" id="goback" value="{{ url_for('team.index') }}" hidden>
            {% endif %}
        </td>
        <td></td>
      </tr>
    </table>
    
  </form>
  <hr>
  <form action="{{ url_for('team.update', id=team['id']) }}" method="get">
    <input class="action" type="submit" value="Modifica">
  </form>
  <script>
    console.log("Sono nello script principale di detail.html");
    var anag_people = JSON.parse(`{{ anag_people | default("[]") | safe }}`);
    var people = JSON.parse(`{{ people | default("[]") | safe }}`);
    
    $("#jsGridPeople").jsGrid({
            width: "40%",
            height: "400px",
            inserting: false, 
            editing: false,
            sorting: true,
            paging: true,
            data: people,
                
            fields: [
                { name: "id", title: "Operatore", type: "select", items: anag_people, valueField: "id", textField: "name", width: "50%", align: "left" }
            ]
          });
          var anag_tool_type = JSON.parse(`{{ anag_tool_type | default("[]") | safe }}`);
          var anag_tools = JSON.parse(`{{ anag_tools | default("[]") | safe }}`);
          var tools = JSON.parse(`{{ tools | default("[]") | safe }}`);

    $("#jsGridTool").jsGrid({
        width: "40%",
        inserting: false,
        editing: false,
        data: tools,
        fields: [
            {
                name: "type_id",
                title: "Categoria",
                type: "select",
                items: anag_tool_type,
                valueField: "type_id",
                textField: "type",
                width: "50%", align: "left"
            },
            {
                name: "tool_id", // ID del Mezzo
                title: "Mezzo",
                type: "select", // Manteniamo select per la visualizzazione in tabella
                items: anag_tools,
                valueField: "tool_id",
                textField: "name",
                width: "50%", align: "left"
            }
        ]
    });
    var anag_acts = JSON.parse(`{{ anag_acts | default("[]") | safe }}`);
    var acts = JSON.parse(`{{ acts | default("[]") | safe }}`);
    $("#jsGridAct").jsGrid({
                width: "40%",
                height: "400px",
                inserting: false, 
                editing: false,
                sorting: true,
                paging: true,
                data: acts,
                    
                fields: [
                    { name: "act_id", title: "Attività", type: "select", items: anag_acts, valueField: "act_id", textField: "act_desc", width: "50%", align: "left" }
                ]
              });

    function goBack() {
      window.location.assign(document.getElementById("goback").value);
    }
  </script>

{% endblock %}
