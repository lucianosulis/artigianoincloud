Switch su database:
use artincloud_prod;

Per sapere quale cartella può ospitare i file generati da MYSQL:
SHOW VARIABLES LIKE 'secure_file_priv';

Per esportare il risultato in un file CSV aggiungere alla query:
INTO OUTFILE '/var/lib/mysql-files/output.csv'
FIELDS TERMINATED BY ';' ENCLOSED BY ''
LINES TERMINATED BY '\n';

Per estrarre le ore lavorate per commessa e persona:

(select 'Cliente', 'ID_Ordine', 'Attività', 'Data_ordine', 'Operatore', 'Data_attività', 'Ore_lavorate')
union all
(select c.full_name as Cliente, o.id as ID_Ordine, o.description as Attività, o.date as Data_ordine, CONCAT(p.surname, ' ',p.name) as Operatore, t.date as Data_attività, t.ore_lav as Ore_lavorate 
from p_order o 
inner join timesheet t on o.id = t.order_id 
inner join people p on p.id = t.people_id
inner join customer c on c.id = o.customer_id
order by o.id, t.date)
INTO OUTFILE '/var/lib/mysql-files/output.csv'
FIELDS TERMINATED BY ';' ENCLOSED BY ''
LINES TERMINATED BY '\n';

Ore lavorate da Farina e suoi collaboratori nel 2025:

(select 'Cliente', 'ID_Ordine', 'Attività', 'Data_ordine', 'Operatore', 'Data_attività', 'Ore_lavorate')
union all
(select c.full_name as Cliente, o.id as ID_Ordine, o.description as Attività, o.date as Data_ordine, CONCAT(p.surname, ' ',p.name) as Operatore, t.date as Data_attività, t.ore_lav as Ore_lavorate 
from p_order o 
inner join timesheet t on o.id = t.order_id 
inner join people p on p.id = t.people_id
inner join customer c on c.id = o.customer_id
where p.surname like '%Farina%' and t.date >= '2025-01-01'
order by t.date)
INTO OUTFILE '/var/lib/mysql-files/output.csv'
FIELDS TERMINATED BY ';' ENCLOSED BY ''
LINES TERMINATED BY '\n';

Ore lavorate da Gastoldi e Rota Dylan a partire dal 22/08/2025:

(select 'Cliente', 'ID_Ordine', 'Attività', 'Data_ordine', 'Operatore', 'Data_attività', 'Ore_lavorate')
union all
(select c.full_name as Cliente, o.id as ID_Ordine, o.description as Attività, o.date as Data_ordine, CONCAT(p.surname, ' ',p.name) as Operatore, t.date as Data_attività, t.ore_lav as Ore_lavorate 
from p_order o 
inner join timesheet t on o.id = t.order_id 
inner join people p on p.id = t.people_id
inner join customer c on c.id = o.customer_id
where (p.surname like '%Gastoldi%' or p.surname like '%Rota%') and t.date >= '2025-08-22'
order by t.date)
INTO OUTFILE '/var/lib/mysql-files/output.csv'
FIELDS TERMINATED BY '|§|' ENCLOSED BY ''
LINES TERMINATED BY '\n';

Associazione ordini - sedi clienti (per analisi Matteo):
(select 'ID_Ordine', 'Attività', 'Operatore', 'Indirizzo', 'Città')
union all
(select a.p_order_id as ID_Ordine, a.title as Attività, concat(p.surname,' ',p.name) as Operatore, s.address as Indirizzo, s.city as Città 
from activity a
inner join site s on s.id = a.site_id 
inner join timesheet t on t.order_id = a.p_order_id 
inner join people p on p.id = t.people_id
where start >= '2024-01-01' and end <= '2024-12-31')
INTO OUTFILE '/var/lib/mysql-files/output.csv'
FIELDS TERMINATED BY ';' ENCLOSED BY ''
LINES TERMINATED BY '\n';

Estrazione manutenzioni:
select tt.type as Tipo, t.brand as Marca, t.model as Modello, t.license_plate as Targa, 
t.serial_number as NumeroSerie, description as Descrizione, m.start as DataInizio, m.end as DataFine 
from maintenance m 
inner join tool t on m.tool_id = t.id
inner join tool_type tt on t.tool_type_id = tt.id
where t.discontinued = 0
INTO OUTFILE '/var/lib/mysql-files/output.csv'
FIELDS TERMINATED BY ';' ENCLOSED BY ''
LINES TERMINATED BY '\n';

(select type from tool_type)
INTO OUTFILE '/var/lib/mysql-files/output.csv'
FIELDS TERMINATED BY ';' ENCLOSED BY ''
LINES TERMINATED BY '\n';

Estrazione utilizzo mezzi:

(select 'Data','Mezzo','Tipo','Ore','Km','Attività','Cliente','Indirizzo','Città')
union all
(select tu.date,concat(t.brand,' ',t.model,' ',t.license_plate ) as tool,
tt.type,tu.ore_lav,tu.km,a.title ,c.full_name as customer, s.address,s.city
from tool_usage tu
inner join tool t on tu.tool_id = t.id
inner join tool_type tt on t.tool_type_id = tt.id
inner join activity a on tu.act_id = a.id
inner join p_order po on a.p_order_id = po.id
inner join customer c on po.customer_id = c.id
inner join site s on s.customer_id = c.id
where tu.date >= '2026-01-01' and tu.date <= '2026-12-31')
INTO OUTFILE '/var/lib/mysql-files/tool_usage.csv'
FIELDS TERMINATED BY ';' ENCLOSED BY ''
LINES TERMINATED BY '\n';

Estrazione ore lavorate:

(select 'Data', 'Cliente', 'ID_Ordine', 'Ordine','Attività', 'Operatore','Ore_lavorate')
union all
(select t.date as data,c.full_name as Cliente, po.id as ID_Ordine, po.description as Ordine,a.title as Attività, CONCAT(p.surname, ' ',p.name) as Operatore,  t.ore_lav as Ore_lavorate 
from p_order po 
inner join timesheet t on po.id = t.order_id 
inner join people p on p.id = t.people_id
inner join customer c on c.id = po.customer_id
inner join activity a on t.act_id = a.id 
order by po.id, t.date)
INTO OUTFILE '/var/lib/mysql-files/ore_lavorateusage.csv'
FIELDS TERMINATED BY ';' ENCLOSED BY ''
LINES TERMINATED BY '\n';








